<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sversity is the online edu. Tech division of Apcosys Private Limited and Apcosys is a software development and consultancy company with headquarter in Bangalore, India. Sversity online learning destination, offering high-quality courses from the world's best universities and institutions to learners everywhere. In the age of internet, do we really need to spend huge amount on getting degrees? One can equally quench his third for knowledge by joining online classes.">
    <title>Leapss - Leave Management System</title>
    {% load static %}
    <link href="{% static 'assets\css\admin.css' %}" rel="stylesheet">
    <link href="{% static 'assets\css\leaveApplication.css' %}" rel="stylesheet">

    <!-- CSS only -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

    <!-- Ionic Icon -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/smoothness/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>

    <!-- bootstrap Icon  -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <!-- Google Icon -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,200,0,0" />
 
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
     
</head>
<body id="body-pd">
    <div class="d-flex" id="wrapper">
        <!-- Sidebar-->
        <div class="border-end bg-white border-right position-sticky header" id="sidebar-wrapper">
            <div class="justify-content-center">
                <div class="leapss"><img src="{% static 'assets/img/logo.png'%}" alt="">
                  <button class="btn" id="sidebarClose"><i class="bi bi-x navToggle"></i>  </button></div>
            </div>
            <ul class="sidebar-nav " id="sidebar-nav">
                <li class="profile"data-bs-toggle="collapse">
                  <img src="{{user.employee.image.url}}" alt="Profile_Image" class="img-fluid rounded-circle">
                  <h6>{{user.employee.name}}</h6>
                </li>
            </ul>
            <div class="list-group list-group-flush" style="list-style:none; margin-top: 10%;">
                <!-- <button class="btn" id="sidebarClose"><span class="bi bi-x "></span></button> -->
                <li ><a class="list-group-item " href="/sidebar"><i class="bi bi-grid" style="margin-left: 20%; font-size:18px;"></i><span></i> <span>Home</span></a></li>
                <li><a class="list-group-item active" href="/leaveSection"> <i class="bi bi-clock" style="margin-left: 20%;font-size:18px; "></i><span></i><span>Leave Section</span></a></li>
                <li><a class="list-group-item " href="/profileSetting"><i class="bi bi-gear" style="margin-left: 20%;font-size:18px;"></i><span></i><span>Profile</span></a></li>
                <li><a class="list-group-item  " href="/leavePolicy"><i class="bi bi-receipt"style="margin-left: 20%;font-size:18px;"></i><span></i><span>Leave Policy</span></a></li>
                <li><a class="list-group-item  " href="/howToUse"><i class="bi bi-book"style="margin-left: 20%;font-size:18px;"></i><span></i><span>How To Use?</span></a></li>
              </div>
             
            
        </div>
        <!-- Page content wrapper-->
        <div id="page-content-wrapper">
            <!-- Top navigation-->
            <nav class="navbar navbar-expand-lg  align-items-center justify-content-between border-bottom position-sticky">
                <!-- <div class="container">
                    <button class="btn" id="sidebarToggle"><span class="navbar-toggler-icon"></span></button>
                </div> -->
                
                <div class="logo d-flex">
                  <button class="btn toggle " id="sidebarToggle"><i class="bi bi-list navToggle"></i></button>
                  {% if com.logo %}
                  <img src="{{ com.logo.url }}" alt="logo">
                  {% else %}
                  <img src="{% static 'assets/img/dummylogo.png' %}" alt="logo" style="width: 43px;">
                  {% endif %}

                    <a href="/sidebar" style="text-decoration:none;"><span>{% if com is None %}Your Company Name{% else %}{{ com.name }}{% endif %}</span></a>
                </div> 
                  <ul class="d-flex">
                    <li style="list-style: none;"class="logOut" style="margin:0%;padding:0%;position: relative; top:10px;">
                        <a type="button" href="{% url 'logout' %}" class="btn "><span class="material-symbols-outlined"style="font-weight: 600; position:relative;top:3px;">
                            logout
                            </span> <span style="font-family: 'Segoe UI', sans-serif; position:relative;bottom:3px; ">Log Out</span></a>
                    </li>
                  </ul>
            </nav>
            <section class="section container pageClass  bg-white rounded dashboard">
               <br>
              <a href="/leaveSection" class="back">
                <i class="bi bi-arrow-left-short">
                  <span>Back</span>
                </i>
              </a>
              <h5 style="color: #009eff; padding: 1% ; "> Leave Application</h5>
                <div class="row" style="margin: 1%;">
                  {% for key,value in dic %}
                  <div class="col-md-3"> 
                    {% if value is not 0 %}
                    <span  style = "text-align:center"class="leftLeaves"> {{key}} : {{ value }}</span>
                    {%endif%}
                  </div>
                  {% endfor %}
                </div>
                
                <center>  
    
                    {% if messages %}
                            <div class ="messages" style="width: 300px;">
                
                        {% for message in messages  %}
                                <div class="alert alert-bg-danger" role="alert">
                                    <strong style="font-size: 15px;"> {{message}}</strong> 
                                </div>
                
                        {% endfor %}
                
                            </div>
                            
                    {% endif %}
            
                </center> 
                <form method="post" style="padding: 2%;" action={% url "leaveApplication" %}>
                  {% csrf_token %}
                    {{form.category}}
                    <div class="row">
                      <div class="col-md-12">
                        <label >Select Status</label>
                        <select class="form-control" name="status" id="status"> 
                          <option value="" >Select Status</option>
                          <option value="Full Day" >Full Day</option>
                          <option value="First Half">First Half</option>
                          <option value="Second Half">Second Half</option>
                        </select>
                      </div>
                      
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <label for="datepicker-from">From</label>
                        {{form.date_from}}
                      </div>
                      <div class="col-md-6">
                        <label for="datepicker-to">To</label>
                        {{form.date_to}}
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <label style="width:100%" for="id_leave_count">
                          <div class="row">
                            <div class="col-md-5"style="padding-right: 0%;">Total Number of Days:</div>
                            <div class="col-md-1" style="padding-left: 0%;">
                              <div id="id_leave" style="font-weight: bold;"></div>
                            </div> 
                            <div class="col-md-6"></div>
                          </div>
                        </label>
                      </div>
                      <div class="col-md-6"></div>
                    </div>
                    {{form.reason}}
                    
                    <input type="hidden" name="leave_count" value="" id="id_leave_count"> 


                    
                    <div class="row">
                      <div class="col-md-8"></div>
                      <div class="col-md-4">
                        <div class="row">
                          <div class="col-md-6">
                            <a type='submit'class="btn btn-primary btn-lg  cancelButton" href="{% url 'leaveSection' %}">Cancel</a>
                          </div>
                          <div class="col-md-6">
                            <button type='submit'class="btn btn-primary btn-lg  submitButton">Submit</button>
                          </div>
                        </div>
                      </div>
                    </div>

                  </form>
                   
              </section>
        </div>
    </div> 
    <script>
      $("#upload_link").click(function(){
        $("#fileUp").trigger('click');
      });
     </script>

     <script language="javascript">
      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0');
      var yyyy = today.getFullYear();

      today = yyyy + '-' + mm + '-' + dd;
      $('#datepicker-from').attr('min',today);

      function minDate(){
        var minimum = document.getElementById('datepicker-from').value
        $('#datepicker-to').attr('min',minimum);
      }

      function enableTo(){
        let get= document.getElementById("datepicker-to")
        get.disabled = false;
      } 
    </script>


  <script>
    $('.dateselect').datepicker({
      multidate: true,
      format: 'dd-mm-yyyy'
    });
  </script>

  <script>
    function restrictWeekends(inputElement) {
      inputElement.addEventListener('input', function(e) {
        var day = new Date(this.value).getUTCDay();
        if ([7, 0].includes(day)) {
          e.preventDefault();
          this.value = '';
          alert('Weekends not allowed');
        }
      });
    }
    
    const from = document.getElementById('datepicker-from');
    const too = document.getElementById('datepicker-to');
    
    restrictWeekends(from);
    restrictWeekends(too);
    
    document.getElementById('status').addEventListener('change', function() {
      updateLeaveCount();
    });

    document.getElementById('datepicker-from').addEventListener('change', function() {
      updateLeaveCount();
    });
    
    document.getElementById('datepicker-to').addEventListener('change', function() {
      updateLeaveCount();
    });
    
    function updateLeaveCount() {
      var From = document.getElementById('datepicker-from').value;
      var to = document.getElementById('datepicker-to').value;
      var status = document.getElementById('status').value;
      console.log(status);
      if(status=='First Half' || status=='Second Half')
      {
        document.getElementById('datepicker-to').readOnly = true;
        document.getElementById('datepicker-to').value = From;
        leaveCount=0.5;
      }
      if(status=='Full Day'){
        document.getElementById('datepicker-to').readOnly = false;
        var date1 = new Date(From);
      var date2 = new Date(to);
      var event_dates = [];

      {% for event in event_list %}
        event_dates.push(new Date("{{ event.isoformat }}"))
      {% endfor %}

      console.log(event_dates)
      dates = [];
      while (date1 <= date2) {
        dates.push(new Date(date1));
        date1.setDate(date1.getDate() + 1);
      }

      console.log(dates);
      days = 0;

      for(var i=0; i<dates.length; i++){
        if(event_dates.indexOf(dates[i]) === -1){
          days = days+1;
        }
      }
    
      // Calculate total days
      var Difference_In_Time = date2.getTime() - date1.getTime();
      //var totalDays = (Difference_In_Time / (1000 * 3600 * 24)) + 1;
      var totalDays = days;
      console.log(totalDays);
    
      // Calculate Sundays within the date range
      var countSundays = 0;
      for (var i = 0; i < totalDays; i++) {
        var currentDate = new Date(date1);
        currentDate.setDate(date1.getDate() + i);
        if (currentDate.getDay() === 0) {  // 0 represents Sunday
          countSundays++;
        }
      }
    
      // Adjust leave count by subtracting Sundays
      var leaveCount = totalDays - countSundays;

      }
      document.getElementById('id_leave_count').value = leaveCount;
      document.getElementById('id_leave').innerHTML = leaveCount;
      
    }
  </script>
    

         
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="{% static 'assets\js\main.js' %}"></script>

</body>
</html>